<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Sensore</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Sensore.styles.css" asp-append-version="true" />
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Sensore</h2>
                <p class="sidebar-sub">Patient Portal</p>
            </div>
            <nav>
                <ul>
                    <li><a asp-controller="PatientHome" asp-action="Index">🏠 Home</a></li>
                    <li><a asp-controller="PatientHome" asp-action="PressureDistribution">📊 Pressure Distribution</a></li>
                    <li><a asp-controller="PatientHome" asp-action="Reports">📁 Reports</a></li>
                    <li><a asp-controller="PatientHome" asp-action="Chat">💬 Chat</a></li>
                </ul>
            </nav>
            <div class="logout">
                <form asp-controller="Loginpage" asp-action="Logout" method="post">
                    <button type="submit" class="logout-btn">🔒 Logout</button>
                </form>
            </div>
        </aside>

        <!-- Main content -->
        <main class="main-content">
            @RenderBody()
        </main>
    </div>

    <!-- 🔔 Notification Bell -->
    <div id="notificationBell" class="notification-bell">
        <i class="fas fa-bell"></i>
        <span id="notifCount" class="notif-count">0</span>
    </div>

    <!-- 📋 Notification Dropdown -->
    <div id="notificationDropdown" class="notification-dropdown" style="display:none;">
        <div class="dropdown-header">
            <strong>Notifications</strong>
            <button id="markAllRead">Mark all read</button>
        </div>
        <div id="notifList" class="notif-list"></div>
    </div>

    <!-- ⚠️ Popup Alert Card -->
    <div id="popupContainer" class="popup-container"></div>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script>
        const bell = document.getElementById('notificationBell');
        const dropdown = document.getElementById('notificationDropdown');
        const notifCount = document.getElementById('notifCount');
        const notifList = document.getElementById('notifList');
        const popupContainer = document.getElementById('popupContainer');

        // Toggle dropdown
        bell.addEventListener('click', () => {
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        });

        // Fetch notifications
        async function fetchNotifications() {
            const res = await fetch('/Notifications/GetAll');
            const data = await res.json();

            notifCount.textContent = data.length;
            notifList.innerHTML = data.map(n => `
                <div class="notif-item">
                    <strong>${n.title}</strong>
                    <p>${n.message}</p>
                    <small>${new Date(n.createdAt).toLocaleTimeString()}</small>
                </div>
            `).join('');
        }

        // Mark all read
        document.getElementById('markAllRead').addEventListener('click', async () => {
            await fetch('/Notifications/MarkAllRead', { method: 'POST' });
            notifCount.textContent = 0;
            fetchNotifications();
        });

        // 🔄 For presentation: auto-generate fake notifications every 8 seconds
        setInterval(async () => {
            await fetch('/Notifications/GenerateFake', { method: 'POST' });
            fetchNotifications();
            showPopup();
        }, 8000);

        // ⚠️ Popup alert on screen
        function showPopup() {
            const popup = document.createElement('div');
            popup.className = 'popup-alert';
            popup.innerHTML = `
                <div class="popup-header">⚠️ Plan to Move Soon</div>
                <p>Your zone is feeling pressure. Adjust your position soon.</p>
            `;
            popupContainer.appendChild(popup);
            setTimeout(() => popup.remove(), 5000);
        }

        fetchNotifications();
    </script>

    <style>
        .notification-bell {
            position: fixed;
            top: 20px;
            right: 40px;
            cursor: pointer;
            font-size: 1.6rem;
            color: #1e3a8a;
        }

        .notif-count {
            background: #ef4444;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.8rem;
            position: absolute;
            top: -5px;
            right: -8px;
        }

        .notification-dropdown {
            position: fixed;
            top: 60px;
            right: 30px;
            width: 320px;
            background: white;
            border-radius: 0.8rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 1rem;
            z-index: 9999;
        }

        .dropdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .notif-item {
            background: #f9fafb;
            padding: 0.6rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .popup-container {
            position: fixed;
            top: 90px;
            right: 30px;
            z-index: 9999;
        }

        .popup-alert {
            background: #fff7ed;
            border: 1px solid #f59e0b;
            border-left: 5px solid #f59e0b;
            border-radius: 0.8rem;
            padding: 1rem;
            margin-top: 0.5rem;
            width: 350px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease;
        }

        .popup-header {
            font-weight: bold;
            color: #b45309;
        }
        @@keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>



</body>
</html>

<style>
    .app-container {
        display: flex;
        min-height: 100vh;
        background: #f9fafc;
    }

    .sidebar {
        width: 240px;
        background: #1e293b;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 1.5rem 1rem;
    }

    .sidebar-header {
        text-align: center;
    }

        .sidebar-header h2 {
            font-size: 1.4rem;
            margin-bottom: 0.2rem;
        }

    .sidebar-sub {
        font-size: 0.85rem;
        color: #cbd5e1;
    }

    .sidebar nav ul {
        list-style: none;
        padding: 0;
        margin: 2rem 0;
    }

  

    .sidebar nav a {
        color: #e2e8f0;
        text-decoration: none;
        font-weight: 500;
        display: block;
        padding: 0.5rem 0.8rem;
        border-radius: 0.5rem;
        transition: background 0.2s;
    }

        .sidebar nav a:hover {
            background: #334155;
        }

    .logout {
        text-align: center;
        margin-top: auto;
    }

    .logout-btn {
        background: #ef4444;
        color: white;
        padding: 0.6rem 1.2rem;
        border-radius: 0.5rem;
        text-decoration: none;
        display: inline-block;
    }

        .logout-btn:hover {
            background: #dc2626;
        }

    .main-content {
        flex: 1;
        padding: 2rem;
        overflow-y: auto;
    }
</style>
